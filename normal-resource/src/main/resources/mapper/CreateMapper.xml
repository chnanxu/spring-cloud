<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chen.mapper.CreateMapper">
    <select id="findProjectByPid">
        select * from item_details where pid=#{pid}
    </select>

    <select id="getCommunityList" >
        select community_id,community_name from community
        order by month_times desc
        OFFSET 0 ROW
        FETCH NEXT 10 ROWS ONLY
    </select>

    <select id="getCommunityListByType" >
        select community_id,community_name from community
        where type_name=#{type_name}
        order by week_times desc
        OFFSET 0 ROW
        FETCH NEXT 10 ROWS ONLY
    </select>


    <insert id="createNewProject" parameterType="Item_Details_Temp">
        insert into item_details_temp values (#{uid},#{uname},#{pid},#{community_id},#{community_name},#{type_id},#{type_name},#{detail_type},#{title},#{simple_text},#{content},#{cover_img},#{href},#{tag},#{isOK},#{create_time},'',#{read_times},#{like_times},#{comments_times},#{favorites})
    </insert>   <!--创建新作品-->

    <update id="takeoffProject">
        update item_details set isTakeoff=1
                where pid=#{pid}
    </update>

    <delete id="deleteMyProject">
        delete from item_details
        where pid=#{pid} and uid=#{uid}
    </delete>

    <select id="getMyProjectCount">
        select count(*) from item_Details where uid=#{uid} and isDeleted=0
    </select>

    <select id="getMyTempProjectCount">
        select count(*) from item_details_temp where uid=#{uid} and (isOK=#{isOK} or isOK=-#{isOK})
    </select>

    <select id="getMyProjectByTime">
        select * from item_details
                 where uid=#{uid} and isDeleted=0 and isTakeoff=0
                 order by create_time desc
        OFFSET ${pageNumber} ROW
        FETCH NEXT 6 ROWS ONLY
        ;
    </select>
    <select id="getMyProjectByHot">
        select * from item_details
                 where uid=#{uid} and isDeleted=0 and isTakeoff=0
                 order by read_times desc
        OFFSET ${pageNumber} ROW
            FETCH NEXT 6 ROWS ONLY;
    </select>
    <select id="getMyProjectByNoAgree">
        select * from item_details_temp
                 where uid=#{uid} and (isOK=1 or isOK=-1)
                 order by create_time desc
        OFFSET ${pageNumber} ROW
            FETCH NEXT 6 ROWS ONLY;
    </select>
    <select id="getMyProjectByDraft">
        select * from item_details_temp
                 where uid=#{uid} and isOK=0
                 order by create_time desc
        OFFSET ${pageNumber} ROW
            FETCH NEXT 6 ROWS ONLY;
    </select>

    <select id="getMyProjectTakeoff">
        select * from item_details
        where uid=#{uid} and isTakeoff=1
        order by create_time desc
        OFFSET ${pageNumber} ROW
        FETCH NEXT 6 ROWS ONLY;
    </select>

    <select id="getMyProjectCoverImgSrc">
        select cover_img from item_details where pid=#{pid}
    </select>
</mapper>